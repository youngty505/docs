Redpanda Cloud API Beta Access

Redpanda Cloud API Beta Access	1
Control Plane APIs	1
Prerequisites	2
Authentication	2
Rate Limiting Defaults	3
Long-running operations	3
Pagination	4
Create a cluster	4
Additional steps for creating BYOC Cluster	5
Delete a cluster	6
Additional steps for deleting BYOC Cluster	6
Data Plane APIs	7
Authentication & Authorization	7
Get Dataplane API URL	7
Create a user	8
Create a ACL

Create a Topic	8
Create a Connector	8
Limitations	8

Welcome to the Redpanda Cloud API Beta! Feedback on your experience can help shape the future of Redpanda Cloud. This document guides you through deploying and managing your Redpanda Cloud environment using the API. 

The Redpanda Cloud API is a REST API that is broken into two different areas. The Control Plane APIs enables you to programmatically manage your clusters outside of the Redpanda Cloud UI. The Data Plane APIs enables you to programmatically manage the resources in your clusters outside of the Redpanda Cloud UI including Topics, Users, ACLs and Connectors. You can call the API endpoints directly, or use tools like Terraform or Python scripts to automate cluster management.

Control Plane APIs

Cloud API URL
https://api.redpanda.com 
Cloud API docs
https://docs.api.redpanda.com/

This includes a console to try API calls directly from your browser. 
URL to get an access token (required for authentication)
https://auth.prd.cloud.redpanda.com/oauth/token


Note: 
To participate in this Beta program:
You must be a customer with an existing organization in Redpanda Cloud.
You can only use one organization for authentication.
Prerequisites 
Authentication
Go to https://cloudv2.redpanda.com/clients to create an OAuth Client. Clients have admin privileges by default, and user roles do not apply for the API.

Click Add client. Enter a name and description.




Retrieve the client ID and secret by clicking Copy ID and Copy Secret. Make a POST request to https://auth.prd.cloud.redpanda.com/oauth/token with the ID and secret in the request body.

Click Request an API token link to see code samples for getting a token.

The request response provides the access token that remains valid for one hour.

You must pass the access token in the authorization header: 


curl -H "Authorization: Bearer $YOUR_TOKEN"

Rate Limiting Defaults


Long-running operations
Some endpoints do not directly return the resource itself, but instead return an operation. Following is an example response of Create Network (POST /networks):

{
  "id": "cl5nlt1c1scg01plkoe0",
  "metadata": {
    "@type": "type.googleapis.com/redpanda.api.controlplane.v1beta1.CreateNetworkMetadata",
    "network_id": "cl5o0td1dafe70i7460g"
  },
  "state": "STATE_IN_PROGRESS",
  "started_at": "2023-11-08T12:35:01.957Z",
  "finished_at": null
}

The response object represents the long-running operation of creating a network. Network creation is an example of an operation that can take a longer period of time to complete.

To check the progress of an operation, call the GET /operations/{id} endpoint using the operation ID as a parameter: 

curl https://api.redpanda.com/v1beta1/operations/cl5nlt1c1scg01plkoe0 

The response contains the current state of the operation: COMPLETED or FAILED.

Pagination
When an endpoint returns a list containing more items than can be returned in a single response, the response object includes a next_page_token. You can pass the token value as a parameter in the next request. When the full list has been returned, next_page_token is an empty string.

Create a cluster
https://docs.api.redpanda.com/#post-/v1beta1/clusters 

Create a namespace:
https://docs.api.redpanda.com/#post-/v1beta1/namespaces 

Pass a name for your namespace in the request body.

curl -H 'Content-Type: application/json' \
-H 'Authorization: Bearer <token>' \
-d '{
  "name": "my-new-namespace"
}' -X POST https://api.redpanda.com/v1beta1/namespaces

A namespace ID is returned. Pass this namespace ID later when you call the Create Cluster endpoint.

Create a network: 
https://docs.api.redpanda.com/#post-/v1beta1/networks

Choose a CIDR range that does not overlap with your existing VPCs or your Redpanda network.


curl -d \
'{
  "cidr_block": "10.0.0.0/20",
  "cloud_provider": "CLOUD_PROVIDER_GCP",
  "cluster_type": "TYPE_DEDICATED",
  "name": "my-network",
  "namespace_id": "6c09e47b-f426-4ec7-a7b4-8048caf8ae47",
  "region": "us-west1"
}' -X POST https://api.redpanda.com/v1beta1/networks 

This endpoint returns a long-running operation. 

After the network is created, call POST /v1beta1/clusters with the namespace ID and network ID in the request body. 


curl -d \
'{
  "cloud_provider": "CLOUD_PROVIDER_GCP",
  "connection_type": "CONNECTION_TYPE_PUBLIC",
  "name": "my-new-cluster",
  "namespace_id": "6c09e47b-f426-4ec7-a7b4-8048caf8ae47",
  "network_id": "cjb69k1c4vs45df9bee0",
  "region": "us-west1",
  "throughput_tier": "tier-1-gcp-um4g",
  "type": "TYPE_DEDICATED",
  "zones": [
    "us-west1-a",
    "us-west1-b",
    "us-west1-c"
    ]
  }
}' -X POST https://api.redpanda.com/v1beta1/clusters 

The Create Cluster endpoint returns a long-running operation. When the operation is completed, you can retrieve cluster details by calling GET /v1beta1/clusters/{id}, passing the cluster ID as a parameter.
Additional steps for creating BYOC Cluster
Ensure that you have installed rpk.
After calling the Create Cluster endpoint, run the rpk cloud byoc command. Pass metadata.cluster_id from the Create Cluster call:
GCP

rpk cloud byoc gcp apply --redpanda-id=<metadata.cluster_id> --project-id=<your-gcp-project-id>
AWS

rpk cloud byoc aws apply --redpanda-id=<metadata.cluster_id>

Delete a cluster
https://docs.api.redpanda.com/#delete-/v1beta1/clusters/-id- 

To delete a cluster, call DELETE /v1beta1/clusters/{id}, passing the cluster ID as a parameter. This is a long-running operation.

curl -X DELETE https://api.redpanda.com/v1beta1/clusters/<cluster_id>

Additional steps for deleting BYOC Cluster
Call GET /v1beta1/clusters/{id} to check the state of the cluster. Wait until the state is STATE_DELETING_AGENT.
After the state changes to STATE_DELETING_AGENT, run rpk cloud byoc to destroy the agent.
GCP

rpk cloud byoc gcp destroy --redpanda-id=<cluster_id> --project-id=<your-gcp-project-id>

AWS

rpk cloud byoc aws destroy --redpanda-id=<cluster_id>

When the cluster is deleted, the delete operation’s state changes to STATE_COMPLETED. At this point, you may call DELETE /v1beta1/networks/{id} to delete the network. This is a long running operation.
Optional: After the network is deleted, call DELETE /v1beta1/namespaces/{id} to delete the namespace. 


Data Plane APIs
Authentication & Authorization
Validate cloud access token (added to Headers for every request)
Check if the user’s organization id matches the org id of the Cluster Console is running in.
Dataplane API supports at the moment only users with the admin role.

Get Dataplane API URL
Redpanda Cloud consists of two main parts: Controlplane and Dataplane.

Controlplane is one central API hosted by Redpanda. It is responsible for provisioning clusters, network, managing billing and users.

Dataplane is the actual redpanda cluster. Every cluster is its own Dataplane, and has therefore its own, distinct, Dataplane API URL.

To retrieve the Dataplane API URL of a cluster, use the Controlplane-API, by calling GetCluster.

The response looks like this:

{
  "id": "....",
  "name": "my-cluster",
....
  "dataplane_api": {
	"url": "https://api-xyz.abc.fmc.ppd.cloud.redpanda.com"
  },
...
}


To connect to Dataplane-API, open API Docs, and select API Servers > Dataplane API. Enter the Dataplane API URL returned by the previous GetCluster call.


Note: Authentication is the same for both Controlplane and Dataplane. You need to do it only once, and use the same token.
Create a user
Create a ACL

Create a Topic
Coming soon!

Create a Connector

Limitations
