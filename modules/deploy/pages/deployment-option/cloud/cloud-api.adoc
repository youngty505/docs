= Manage Clusters using the Cloud API
:description: Use the cloud API to manage your clusters in Redpanda Cloud.
:page-cloud: true

The Redpanda Cloud API is a collection of REST APIs that allow you to interact with different parts of Redpanda Cloud. The Control Plane API enables you to programmatically manage your clusters outside of the Redpanda Cloud UI. You can call the API endpoints directly, or use tools like Terraform or Python scripts to automate cluster management.

== Requirements

. You must be a customer with an existing organization in Redpanda Cloud.
. You can only use one organization for authentication.

== Authentication

. Go to the https://cloudv2.redpanda.com/clients[Redpanda Cloud UI] to create an OAuth Client. 
+
NOTE: Clients have admin privileges by default, and user roles do not apply for the API.

. Click *Add client*. Enter a name and description.

. Retrieve the client ID and secret by clicking *Copy ID* and *Copy Secret*. Make a POST request to `\https://auth.prd.cloud.redpanda.com/oauth/token` with the ID and secret in the request body. To see code examples for getting a token, click the *Request an API token*.
+
The request response provides the access token that remains valid for one hour.

You must pass the access token in the authorization header of your API requests: 

```bash
curl -H "Authorization: Bearer $YOUR_TOKEN"
```

== Pagination

When an endpoint returns a list containing more items than can be returned in a single response, the response object includes a `next_page_token`. You can pass the token value as a parameter in the next request. When the full list has been returned, `next_page_token` is an empty string.

== Use the API docs to test the Cloud API

All Cloud API endpoints are documented in our API reference. In the API docs, you can:

- Invoke all endpoints directly from your browser
- Inspect the autogenerated cURL request based on the input parameters you provide
- See the request and response schema for different HTTP status codes, and request and response examples 

Before you can issue actual requests from the browser against the Control Plane API, you must:

. <<authentication,Authenticate>> with your Redpanda Cloud account.
. In the API reference, click *Authentication* in the sidebar.
. Click the *Get Token* button. Do not edit the input field next to the button.
. If successful, the text “1 API key applied” displays near the top of the page.
. Choose the correct API server for your request.
+
For requests to the Control Plane API:
+
--
.. Click *API Servers* in the sidebar. 
.. Select “https://api.redpanda.com - Controlplane API”. 
+
The following services consist of Control Plane API endpoints:
+
* ClusterService
* NamespaceService
* OperationService
* NetworkService
--

== Control Plane API

The Control Plane API is one central API that allows you to provision clusters and networks.

== Long-running operations

Some endpoints do not directly return the resource itself, but instead return an operation. The following is an example response of Create Network (`POST /networks`):

[,bash,role=no-copy]
----
{
  "id": "cl5nlt1c1scg01plkoe0",
  "metadata": {
    "@type": "type.googleapis.com/redpanda.api.controlplane.v1beta1.CreateNetworkMetadata",
    "network_id": "cl5o0td1dafe70i7460g"
  },
  "state": "STATE_IN_PROGRESS",
  "started_at": "2023-11-08T12:35:01.957Z",
  "finished_at": null
}
----

The response object represents the long-running operation of creating a network. Network creation is an example of an operation that can take a longer period of time to complete.

To check the progress of an operation, call the `GET /operations/{id}` endpoint using the operation ID as a parameter: 

```bash
curl https://api.redpanda.com/v1beta1/operations/<operation-id>
```

The response contains the current state of the operation: `COMPLETED` or `FAILED`.

=== Create a cluster

. First, create a namespace by making a POST request to the `/v1beta1/namespaces` endpoint. Pass a name for your namespace in the request body.
+
[,bash]
----
curl -H 'Content-Type: application/json' \
-H 'Authorization: Bearer <token>' \
-d '{
  "name": "my-new-namespace"
}' -X POST https://api.redpanda.com/v1beta1/namespaces
----
+
A namespace ID is returned. Pass this namespace ID later when you call the Create Cluster endpoint.

. Create a network by calling `POST /v1beta1/networks`.
+
Choose a CIDR range that does not overlap with your existing VPCs or your Redpanda network.
+
[,bash]
----
curl -d \
'{
  "cidr_block": "10.0.0.0/20",
  "cloud_provider": "CLOUD_PROVIDER_GCP",
  "cluster_type": "TYPE_DEDICATED",
  "name": "my-network",
  "namespace_id": "<namespace_id>",
  "region": "us-west1"
}' -X POST https://api.redpanda.com/v1beta1/networks 
----
+
This endpoint returns a <<long_running_operations,long-running operation>>. 

. After the network is created, call `POST /v1beta1/clusters` with the namespace ID and network ID in the request body. 
+
[,bash]
----
curl -d \
'{
  "cloud_provider": "CLOUD_PROVIDER_GCP",
  "connection_type": "CONNECTION_TYPE_PUBLIC",
  "name": "my-new-cluster",
  "namespace_id": "<namespace_id>",
  "network_id": "<network-id>",
  "region": "us-west1",
  "throughput_tier": "tier-1-gcp-um4g",
  "type": "TYPE_DEDICATED",
  "zones": [
    "us-west1-a",
    "us-west1-b",
    "us-west1-c"
    ]
  }
}' -X POST https://api.redpanda.com/v1beta1/clusters
----

The Create Cluster endpoint returns a long-running operation. When the operation is completed, you can retrieve cluster details by calling `GET /v1beta1/clusters/{id}`, passing the cluster ID as a parameter.

==== Additional steps to create a BYOC cluster

. Ensure that you have installed rpk.
. After calling the Create Cluster endpoint, run the `rpk cloud byoc` command. Pass `metadata.cluster_id` from the Create Cluster call:
+
[tabs]
====
GCP::
+
--
```bash
rpk cloud byoc gcp apply --redpanda-id=<metadata.cluster_id> --project-id=<gcp-project-id>
```
--
AWS::
+
--
```bash
rpk cloud byoc aws apply --redpanda-id=<metadata.cluster_id>
```
--
====

=== Delete a cluster

To delete a cluster, call `DELETE /v1beta1/clusters/{id}`, passing the cluster ID as a parameter. This is a long-running operation.

```bash
curl -X DELETE https://api.redpanda.com/v1beta1/clusters/<cluster_id>
```

==== Additional steps to delete a BYOC cluster

. Call `GET /v1beta1/clusters/{id}` to check the state of the cluster. Wait until the state is `STATE_DELETING_AGENT`.
. After the state changes to `STATE_DELETING_AGENT`, run `rpk cloud byoc` to destroy the agent.
+
[tabs]
====
GCP::
+
--
```bash
rpk cloud byoc gcp destroy --redpanda-id=<cluster_id> --project-id=<gcp-project-id>
```
--
AWS::
+
--
```bash
rpk cloud byoc aws destroy --redpanda-id=<cluster_id>
```
--
====

. When the cluster is deleted, the delete operation’s state changes to `STATE_COMPLETED`. At this point, you may call `DELETE /v1beta1/networks/{id}` to delete the network. This is a long running operation.
. Optional: After the network is deleted, call `DELETE /v1beta1/namespaces/{id}` to delete the namespace. 

